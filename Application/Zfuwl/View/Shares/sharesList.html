<!DOCTYPE html>
<html>
<head>
    <include file='Public/top' />
    <script type="text/javascript" src="__PUBLIC__/js/ajax.js"></script>
    <link rel="stylesheet" href="__PUBLIC__/plugins/layui/build/css/layui.css"  media="all">
</head>

<body>
<div class="admin-main">
    <blockquote class="layui-elem-quote">
        <form action="{:U('Excel/exportAccountLog')}" id="search-form2">
           <!-- <div class="layui-inline"><div class="layui-input-inline"><input type="text" name="shares_name" placeholder="股票名称" class="layui-input" /></div></div>
            <div class="layui-inline">
                <div class="layui-input-inline">
                    <select name="is_type" class="layui-input">
                        <option value="">&#45;&#45;状态&#45;&#45;</option>
                        <foreach name='sharesType' item='v' key='k'>
                            <option value="{$k}">{$v}</option>
                        </foreach>
                    </select>
                </div>
            </div>-->
            <input type="hidden" name="order_by" value="id">
            <input type="hidden" name="sort" value="desc">
            <!--<button type="button" onclick="ajax_get_table('search-form2',1);" class="layui-btn"><i class="layui-icon">&#xe615;</i> 搜索</button>-->
            <!--<button type="submit" class="layui-btn"><i class="icon iconfont">&#xe60a;</i> 导出excel</button>-->
            <button type="button" onclick="location.reload();" class="layui-btn pull-right"><i class="layui-icon">&#x1002;</i> 刷新</button>
            <button type="button" class="layui-btn layui-btn-normal pull-right add" ><i class="fa fa-plus-circle"></i> 新增发行兑换劵</button>
            <div style="clear: both;"></div>
        </form>
    </blockquote>
    <div style="clear:both;"></div>
    <fieldset class="layui-elem-field">
        <div class="layui-field-box">
            <div id="ajax_return"></div>
        </div>
    </fieldset>
</div>
<script type="text/javascript" src="__PUBLIC__/plugins/layui/layui.js"></script>
<script src="__PUBLIC__/plugins/layui/build/layui.js" charset="utf-8"></script>
<script>
    layui.use(['laydate', 'layer', 'form'], function () {
        var $ = layui.jquery,form=layui.form;
        //请求表单
        $(document).ready(function(){
            ajax_get_table('search-form2',1);
        });
        $('.add').click(function () {
            var url = "{:U('Shares/sharesIssueAdd')}";
            $.get(url, function (data) {
                if (data.status == 0) {
                    layer.msg(data.msg, {icon: 5});
                    return;
                }
                layer.open({
                    title: '发行兑换劵',
                    type: 1,
                    skin: 'layui-layer-rim', //加上边框
                    area: ['80%', '80%'], //宽高
                    content: data
                });
            });
        });
        $('.clearData').click(function () {
            layer.confirm("是否确认清空数据，执行之后将不能撤销", {title:'温馨提示', icon:3}, function(){
                var url = "{:U('Shares/clearSharesData')}";
                var layerIndex = layer.msg('清空中...', {icon:16, time:0, shade:0.1});
                $.post(url, function (data) {
                    layer.close(layerIndex);
                    if (data.status == 0) {
                        layer.msg(data.msg, {icon: 5});
                        return;
                    } else if(data.status == 1) {
                        var page = $('.pagination .active').find('a').data('p');
                        ajax_get_table('search-form2', page);
                        layer.msg(data.msg, {icon: 6, time: 2000});
                    }
                });
            });
        });
    });

    function ajax_get_table(tab, page){
        var loadVal = layer.load(3);
        cur_page = page;
        $.ajax({
            type: "POST",
            url: "{:U('Shares/sharesList')}?p=" + page,
            data: $('#' + tab).serialize(),
            success: function (data) {
                if (data.status == 0) {
                    layer.msg(data.msg, {icon: 5});
                    return;
                }
                layer.close(loadVal);
                $("#ajax_return").html(data);
            }
        });
    }
    // 点击排序
    function sort(field){
        $("input[name='order_by']").val(field);
        var v = $("input[name='sort']").val() == 'desc' ? 'asc' : 'desc';
        $("input[name='sort']").val(v);
        ajax_get_table('search-form2', cur_page);
    }
</script>
</body>

</html>